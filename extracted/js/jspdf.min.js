// Minimal jsPDF wrapper - uses browser's built-in PDF generation
// Enhanced version with better layout and image support

window.generatePDF = function(formData) {
    // Create a beautifully formatted HTML for PDF export
    const pdfWindow = window.open('', '_blank', 'width=1000,height=800');
    
    // Determine image source
    let imageHTML = '';
    if (formData.imageType === 'upload' && formData.uploadedImage) {
        imageHTML = `<img src="${formData.uploadedImage}" alt="Persona" style="width: 120px; height: 120px; object-fit: cover; border-radius: 60px;">`;
    } else if (formData.imageType === 'avatar' && formData.selectedAvatar) {
        const avatars = [
            { id: 1, image: 'images/avatars/avatar-1.svg' },
            { id: 2, image: 'images/avatars/avatar-2.svg' },
            { id: 3, image: 'images/avatars/avatar-3.svg' },
            { id: 4, image: 'images/avatars/avatar-4.svg' },
            { id: 5, image: 'images/avatars/avatar-5.svg' },
            { id: 6, image: 'images/avatars/avatar-6.svg' }
        ];
        const avatar = avatars.find(a => a.id === formData.selectedAvatar);
        if (avatar) {
            imageHTML = `<img src="${avatar.image}" alt="Avatar" style="width: 120px; height: 120px; object-fit: cover; border-radius: 60px;">`;
        } else {
            imageHTML = `<div style="width: 120px; height: 120px; border-radius: 60px; background: #FFCF02; display: flex; align-items: center; justify-content: center; font-size: 60px; color: white;">ðŸ‘¤</div>`;
        }
    } else {
        imageHTML = `<div style="width: 120px; height: 120px; border-radius: 60px; background: #FFCF02; display: flex; align-items: center; justify-content: center; font-size: 60px; color: white;">ðŸ‘¤</div>`;
    }
    
    const html = `
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Persona: ${formData.name || 'Teilnehmer'}</title>
    <style>
        @page { 
            margin: 2cm;
            size: A4;
        }
        
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            color: #304F5D;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
        }
        
        .page-container {
            max-width: 800px;
            margin: 0 auto;
        }
        
        /* Header with learn@shift branding */
        .header {
            background: linear-gradient(135deg, #FFCF02 0%, #FFE24D 100%);
            padding: 40px;
            border-radius: 30px;
            margin-bottom: 40px;
            text-align: center;
            box-shadow: 0 4px 20px rgba(255, 207, 2, 0.2);
        }
        
        .header h1 {
            margin: 0;
            font-size: 36px;
            color: #304F5D;
            font-weight: 700;
        }
        
        .header .subtitle {
            margin: 10px 0 0 0;
            color: #6F868F;
            font-size: 14px;
        }
        
        /* Profile section */
        .profile {
            display: flex;
            gap: 30px;
            margin-bottom: 40px;
            padding: 30px;
            background: #FFF5CC;
            border-radius: 25px;
            align-items: center;
            page-break-inside: avoid;
        }
        
        .profile-image {
            flex-shrink: 0;
        }
        
        .profile-info h2 {
            margin: 0 0 8px 0;
            color: #304F5D;
            font-size: 28px;
        }
        
        .profile-info .meta {
            margin: 0;
            color: #6F868F;
            font-size: 16px;
        }
        
        /* Content sections */
        .section {
            margin-bottom: 30px;
            page-break-inside: avoid;
        }
        
        .section-header {
            background: linear-gradient(to right, #FFCF02, #FFE24D);
            padding: 15px 30px;
            border-radius: 50px;
            font-weight: 700;
            color: #304F5D;
            margin-bottom: 20px;
            font-size: 18px;
            box-shadow: 0 2px 10px rgba(255, 207, 2, 0.2);
        }
        
        .section-content {
            padding: 0 30px;
            color: #304F5D;
        }
        
        .section-content p {
            margin: 12px 0;
            font-size: 14px;
        }
        
        .section-content strong {
            color: #304F5D;
            font-weight: 600;
        }
        
        .pill-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }
        
        .pill {
            background: white;
            border: 2px solid #FFE24D;
            padding: 8px 16px;
            border-radius: 50px;
            font-size: 13px;
            color: #304F5D;
        }
        
        /* Footer */
        .footer {
            margin-top: 60px;
            padding-top: 30px;
            border-top: 3px solid #FFE24D;
            text-align: center;
            color: #6F868F;
            font-size: 12px;
        }
        
        .footer .logo {
            font-size: 24px;
            font-weight: bold;
            color: #304F5D;
            margin-bottom: 10px;
        }
        
        .footer .logo .at {
            color: #FFCF02;
        }
        
        /* Print button */
        .print-button {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: linear-gradient(135deg, #33A966, #33A966);
            color: white;
            border: none;
            padding: 18px 36px;
            border-radius: 50px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 6px 20px rgba(51, 169, 102, 0.3);
            transition: all 0.3s;
            z-index: 1000;
        }
        
        .print-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(51, 169, 102, 0.4);
        }
        
        @media print {
            body { 
                background: white;
                padding: 0;
            }
            .print-button { 
                display: none;
            }
            .page-container {
                max-width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="page-container">
        <!-- Header -->
        <div class="header">
            <h1>Teilnehmer-Persona</h1>
            <p class="subtitle">learn@shift | BFW Dortmund</p>
        </div>
        
        <!-- Profile -->
        <div class="profile">
            <div class="profile-image">
                ${imageHTML}
            </div>
            <div class="profile-info">
                <h2>${formData.name || 'Persona Name'}</h2>
                <p class="meta">${formData.alter ? formData.alter + ' Jahre' : 'Alter nicht angegeben'} ${formData.beruf ? ' | ' + formData.beruf : ''}</p>
            </div>
        </div>
        
        <!-- Reha-Kontext -->
        ${(formData.einschraenkung || formData.foerderbedarf || formData.ziele) ? `
        <div class="section">
            <div class="section-header">Reha-Kontext</div>
            <div class="section-content">
                ${formData.einschraenkung ? `<p><strong>EinschrÃ¤nkung:</strong> ${formData.einschraenkung}</p>` : ''}
                ${formData.foerderbedarf ? `<p><strong>FÃ¶rderbedarf:</strong> ${formData.foerderbedarf}</p>` : ''}
                ${formData.ziele ? `<p><strong>Ziele:</strong> ${formData.ziele}</p>` : ''}
            </div>
        </div>
        ` : ''}
        
        <!-- Digitale Kompetenzen -->
        ${(formData.digitalErfahrung || formData.technikZugang || formData.digitalBarrieren) ? `
        <div class="section">
            <div class="section-header">Digitale Kompetenzen</div>
            <div class="section-content">
                ${formData.digitalErfahrung ? `<p><strong>Vorerfahrung:</strong> ${formData.digitalErfahrung}</p>` : ''}
                ${formData.technikZugang ? `<p><strong>Technik-Zugang:</strong> ${formData.technikZugang}</p>` : ''}
                ${formData.digitalBarrieren ? `<p><strong>Digitale Barrieren:</strong> ${formData.digitalBarrieren}</p>` : ''}
            </div>
        </div>
        ` : ''}
        
        <!-- LernprÃ¤ferenzen -->
        ${(formData.bevorzugteFormate.length > 0 || formData.tempo || formData.selbststaendigkeit) ? `
        <div class="section">
            <div class="section-header">LernprÃ¤ferenzen</div>
            <div class="section-content">
                ${formData.bevorzugteFormate.length > 0 ? `
                    <p><strong>Bevorzugte Formate:</strong></p>
                    <div class="pill-list">
                        ${formData.bevorzugteFormate.map(f => `<span class="pill">${f}</span>`).join('')}
                    </div>
                ` : ''}
                ${formData.tempo ? `<p><strong>Lerntempo:</strong> ${formData.tempo}</p>` : ''}
                ${formData.selbststaendigkeit ? `<p><strong>SelbststÃ¤ndigkeit:</strong> ${formData.selbststaendigkeit}</p>` : ''}
            </div>
        </div>
        ` : ''}
        
        <!-- Herausforderungen -->
        ${formData.herausforderungen ? `
        <div class="section">
            <div class="section-header">Herausforderungen bei digitalen Lernmodulen</div>
            <div class="section-content">
                <p>${formData.herausforderungen.replace(/\n/g, '<br>')}</p>
            </div>
        </div>
        ` : ''}
        
        <!-- UnterstÃ¼tzungsbedarf -->
        ${formData.unterstuetzung ? `
        <div class="section">
            <div class="section-header">UnterstÃ¼tzungsbedarf</div>
            <div class="section-content">
                <p>${formData.unterstuetzung.replace(/\n/g, '<br>')}</p>
            </div>
        </div>
        ` : ''}
        
        <!-- Footer -->
        <div class="footer">
            <div class="logo">learn<span class="at">@</span>shift</div>
            <p>Erstellt am ${new Date().toLocaleDateString('de-DE', { day: '2-digit', month: '2-digit', year: 'numeric' })}</p>
            <p style="font-size: 10px; margin-top: 5px;">BFW Dortmund â€“ BerufsfÃ¶rderungswerk</p>
        </div>
    </div>
    
    <!-- Print Button -->
    <button class="print-button" onclick="window.print()">
        ðŸ“„ Als PDF speichern
    </button>
</body>
</html>`;
    
    pdfWindow.document.write(html);
    pdfWindow.document.close();
};
